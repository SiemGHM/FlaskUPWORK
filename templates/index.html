<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Processing</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <h1 class="mb-4">Upload and Process Image</h1>
          <form id="imageForm" enctype="multipart/form-data">
            <div class="mb-3">
              <input
                class="form-control"
                type="file"
                id="imageInput"
                accept="image/*"
                required
              />
            </div>
            <div class="progress mb-3" style="display: none">
              <div
                id="progressBar"
                class="progress-bar"
                role="progressbar"
                style="width: 0%"
                aria-valuenow="0"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
            <button class="btn btn-primary" type="submit">
              Upload & Process
            </button>
          </form>
          <div id="imageResults" class="mt-4 d-none">
            <div class="row">
              <div class="col-md-6">
                <h2>Uploaded Image</h2>
                <img
                  id="uploadedImage"
                  class="img-fluid"
                  src=""
                  alt="Uploaded Image"
                />
              </div>
              <div class="col-md-6">
                <h2>Processed Image</h2>
                <img
                  id="processedImage"
                  class="img-fluid"
                  src=""
                  alt="Processed Image"
                />
              </div>
            </div>
            <!-- Confusion Matrix div, initially hidden -->
            <div class="container mt-5 d-none" id="confusionMatrix2">
              <h1>Confusion Matrix Train</h1>
              <table class="table matrix-table">
                  <thead>
                      <tr>
                          <th>Predicted / Actual</th>
                          <th>Predicted Negative</th>
                          <th>Predicted Actual</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr>
                          <td>Actual Positive </td>
                          <td> </td>
                          <td></td>
                      </tr>
                      <tr>
                          <td>Actual Negative (FP)</td>
                          <td> </td>
                          <td> </td>
                      </tr>
                      <!-- Add more rows here if you have more classes -->
                  </tbody>
              </table>
          </div>


          <!-- Confusion Matrix div, initially hidden -->
          <div class="container mt-5 d-none" id="confusionMatrix">
            <h1>Confusion Matrix Test</h1>
            <table class="table matrix-table2">
                <thead>
                    <tr>
                        <th>Predicted / Actual</th>
                        <th>Predicted Negative</th>
                        <th>Predicted Actual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Actual Positive </td>
                        <td> </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Actual Negative (FP)</td>
                        <td> </td>
                        <td> </td>
                    </tr>
                    <!-- Add more rows here if you have more classes -->
                </tbody>
            </table>
        </div>





          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript -->
    <script>
        document.getElementById("imageForm").addEventListener("submit", function (event) {
          event.preventDefault();
          var formData = new FormData();
          var fileInput = document.getElementById("imageInput");
          var file = fileInput.files[0];
          formData.append("image", file);
          var progressBar = document.getElementById("progressBar");
          progressBar.style.width = "0%";
          progressBar.innerText = "0%";
          progressBar.parentElement.style.display = "block";
        
          fetch("/process_image", {
            method: "POST",
            body: formData,
          })
          .then((response) => response.json())
          .then((data) => {
            if (data.message) {
              document.getElementById("uploadedImage").src = URL.createObjectURL(file);
              document.getElementById("processedImage").src = "data:image/jpeg;base64," + data.image_data;
              
              // Update confusion matrix values
              var matrix = data.confusion_matrix; // Assuming this is how your data is structured
              document.querySelector(".matrix-table tbody").innerHTML = `
                <tr>
                  <td>Actual Positive</td>
                  <td>${matrix[0][0]}</td>
                  <td>${matrix[0][1]}</td>
                </tr>
                <tr>
                  <td>Actual Negative</td>
                  <td>${matrix[1][0]}</td>
                  <td>${matrix[1][1]}</td>
                </tr>
                <!-- Add more rows dynamically if needed -->`;
        
              // Remove 'd-none' class to display results and confusion matrix
              document.getElementById("imageResults").classList.remove("d-none");
              document.getElementById("confusionMatrix").classList.remove("d-none");

              var matrix2 = data.confusion_matrix2;
              document.querySelector(".matrix-table2 tbody").innerHTML = `
                <tr>
                  <td>Actual Positive</td>
                  <td>${matrix2[0][0]}</td>
                  <td>${matrix2[0][1]}</td>
                </tr>
                <tr>
                  <td>Actual Negative</td>
                  <td>${matrix2[1][0]}</td>
                  <td>${matrix2[1][1]}</td>
                </tr>
                <!-- Add more rows dynamically if needed -->`;
        
              // Remove 'd-none' class to display results and confusion matrix
              document.getElementById("imageResults").classList.remove("d-none");
              document.getElementById("confusionMatrix2").classList.remove("d-none");

              
            } else {
              alert(data.error);
            }
            progressBar.parentElement.style.display = "none";
          })
          .catch((error) => {
            console.error("Error:", error);
            progressBar.parentElement.style.display = "none";
          });
        });
        </script>
        
  </body>
</html>
